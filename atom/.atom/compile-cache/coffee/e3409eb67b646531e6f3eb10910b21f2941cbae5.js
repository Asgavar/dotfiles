(function() {
  var CompositeDisposable, Emitter, MATCH_PAIRS, RailroadDiagramElement, Range, debounce, issue58, log_debug, ref;

  ref = require('atom'), CompositeDisposable = ref.CompositeDisposable, Emitter = ref.Emitter, Range = ref.Range;

  debounce = require("underscore-plus").debounce;

  RailroadDiagramElement = require("./railroad-diagram-element.coffee");

  MATCH_PAIRS = {
    '(': ')',
    '[': ']',
    '{': '}',
    '<': '>'
  };

  issue58 = require('semver').lt(atom.appVersion, "1.18.0");

  log_debug = console.log.bind(console, "rx2rr");

  log_debug = function() {};

  module.exports = {
    regexRailroadDiagramView: null,
    config: {
      enabled: {
        type: "boolean",
        "default": true
      }
    },
    activate: function(state) {
      this.subscriptions = new CompositeDisposable;
      this.emitter = new Emitter;
      this.element = (new RailroadDiagramElement).initialize(this);
      this.subscriptions.add(atom.workspace.observeTextEditors((function(_this) {
        return function(editor) {
          return _this.subscriptions.add(editor.onDidChangeCursorPosition(debounce((function() {
            return _this.checkForRegExp();
          }), 100)));
        };
      })(this)));
      this.subscriptions.add(atom.commands.add('atom-text-editor', {
        'regex-railroad-diagram:show': (function(_this) {
          return function() {
            var editor, flavour, options;
            if (!_this.element.isVisible()) {
              console.log("is not visible");
              flavour = 'perl';
              options = '';
              editor = atom.workspace.getActiveTextEditor();
              _this.element.showDiagram(editor.getSelectedText(), {
                flavour: flavour,
                options: options
              });
              return _this.element.focusTextEditor();
            } else {
              return console.log("is visible");
            }
          };
        })(this)
      }));
      if (atom.config.get('regex-railroad-diagram.enabled')) {
        return this.addDisableCommand();
      } else {
        return this.addEnableCommand();
      }
    },
    addDisableCommand: function() {
      return this.cur_cmd = atom.commands.add("atom-workspace", "regex-railroad-diagram:disable", (function(_this) {
        return function() {
          _this.cur_cmd.dispose();
          atom.config.set('regex-railroad-diagram.enabled', false);
          _this.addEnableCommand();
          return _this.checkForRegExp();
        };
      })(this));
    },
    addEnableCommand: function() {
      return this.cur_cmd = atom.commands.add("atom-workspace", "regex-railroad-diagram:enable", (function(_this) {
        return function() {
          _this.cur_cmd.dispose();
          atom.config.set('regex-railroad-diagram.enabled', true);
          _this.addDisableCommand();
          return _this.checkForRegExp();
        };
      })(this));
    },
    deactivate: function() {
      return this.subscriptions.dispose();
    },
    serialize: function() {},
    bufferRangeForScope: function(editor, scope, position) {
      var end, endTabs, lineStart, m, result, start, startTabs, tabLength;
      if (position == null) {
        position = null;
      }
      if (!issue58) {
        if (position != null) {
          result = editor.bufferRangeForScopeAtPosition(scope, position);
        } else {
          result = editor.bufferRangeForScopeAtCursor(scope);
        }
        return result;
      }
      tabLength = editor.getTabLength();
      if (position == null) {
        position = editor.getCursorBufferPosition().copy();
      }
      lineStart = [[position.row, 0], [position.row, position.column]];
      if (m = editor.getTextInBufferRange(lineStart).match(/\t/g)) {
        startTabs = m.length;
      } else {
        startTabs = 0;
      }
      if (startTabs) {
        position.column = position.column - startTabs + startTabs * tabLength;
      }
      result = editor.bufferRangeForScopeAtPosition(scope, position);
      if (!result) {
        return result;
      }
      start = result.start, end = result.end;
      lineStart = [[end.row, 0], [end.row, end.column]];
      if (m = editor.getTextInBufferRange(lineStart).match(/\t/g)) {
        endTabs = m.length;
      } else {
        endTabs = 0;
      }
      return new Range([start.row, start.column - startTabs * tabLength + startTabs], [end.row, end.column - endTabs * tabLength + endTabs]);
    },
    getRegexpBufferRange: function(editor) {
      var flavour, position, range;
      position = editor.getCursorBufferPosition();
      flavour = editor.scopeDescriptorForBufferPosition(position).scopes[0];
      range = this.bufferRangeForScope(editor, '.raw-regex');
      if (!range) {
        range = this.bufferRangeForScope(editor, '.unicode-raw-regex');
      }
      if (!range) {
        range = this.bufferRangeForScope(editor, '.regexp');
      }
      if (!range) {
        return [null, null];
      }
      return [range, flavour];
    },
    cleanRegex: function(regex, flavour) {
      var close, expectedClose, m, open, opts, ref1, ref2, ref3, ref4, ref5, regexForEscaped, text;
      opts = "";
      log_debug("cleanRegex", regex, flavour);
      if (m = flavour.match(/php/) && regex.match(/^(["'])\/(.*)\/(\w*)\1$/)) {
        ref1 = m.slice(2), regex = ref1[0], opts = ref1[1];
      } else if (m = flavour.match(/python|julia/) && regex.match(/^u?r('''|"""|"|')(.*)\1$/)) {
        regex = m[2];
      } else if (m = flavour.match(/coffee/) && regex.match(/^\/\/\/(.*)\/\/\/(\w*)/)) {
        ref2 = m.slice(1), regex = ref2[0], opts = ref2[1];
      } else if (m = flavour.match(/ruby/) && regex.match(/^%r(.)(.*)(\W)(\w*)$/)) {
        ref3 = m.slice(1), open = ref3[0], text = ref3[1], close = ref3[2], opts = ref3[3];
        expectedClose = MATCH_PAIRS[open] || open;
        if (close !== expectedClose) {
          text = text + close + m[4];
          close = expectedClose;
        }
        regexForEscaped = new RegExp("\\\\(" + open + "|" + close + ")", 'g');
        regex = text.replace(new RegExp("\\/", '\\/').replace(regexForEscaped, '$1'));
      } else if (m = flavour.match(/perl/) && (regex.match(/^(?:m|qr)(.)(.*)(\1|\W)(\w*)$/) || regex.match(/^s(.)(.*)(\1|\W)(?:\1.*\W|.*\1)(\w*)$/))) {
        ref4 = m.slice(1), open = ref4[0], text = ref4[1], close = ref4[2], opts = ref4[3];
        expectedClose = MATCH_PAIRS[open] || open;
        if (close !== expectedClose) {
          text = text + close + m[4];
          close = expectedClose;
        }
        regexForEscaped = new RegExp("\\\\(" + open + "|" + close + ")", 'g');
        regex = text.replace(/\//, '\\/').replace(regexForEscaped, '$1');
      } else if (m = regex.match(/^\/(.*)\/(\w*)$/)) {
        ref5 = m.slice(1), regex = ref5[0], opts = ref5[1];
      }
      log_debug("cleanRegex done:", regex, opts);
      return [regex, opts];
    },
    checkForRegExp: function() {
      var editor, flavour, options, range, ref1, ref2, regex;
      if (!atom.config.get('regex-railroad-diagram.enabled')) {
        return this.element.assertHidden();
      }
      editor = atom.workspace.getActiveTextEditor();
      if (editor == null) {
        return;
      }
      ref1 = this.getRegexpBufferRange(editor), range = ref1[0], flavour = ref1[1];
      log_debug("range", range, "flavour", flavour);
      if (!range) {
        return this.element.assertHidden();
      } else {
        regex = editor.getTextInBufferRange(range).trim();
        if (regex === '/') {
          return this.element.assertHidden();
        }
        ref2 = this.cleanRegex(regex, flavour), regex = ref2[0], options = ref2[1];
        return this.element.showDiagram(regex, {
          flavour: flavour,
          options: options
        });
      }
    }
  };

}).call(this);

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiL2hvbWUvYXNnYXZhci9kb3RmaWxlcy9hdG9tLy5hdG9tL3BhY2thZ2VzL3JlZ2V4LXJhaWxyb2FkLWRpYWdyYW0vbGliL3JlZ2V4LXJhaWxyb2FkLWRpYWdyYW0uY29mZmVlIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUNBO0FBQUEsTUFBQTs7RUFBQSxNQUF3QyxPQUFBLENBQVEsTUFBUixDQUF4QyxFQUFDLDZDQUFELEVBQXNCLHFCQUF0QixFQUErQjs7RUFDOUIsV0FBWSxPQUFBLENBQVEsaUJBQVI7O0VBQ2Isc0JBQUEsR0FBeUIsT0FBQSxDQUFRLG1DQUFSOztFQUV6QixXQUFBLEdBQWM7SUFBQSxHQUFBLEVBQUssR0FBTDtJQUFVLEdBQUEsRUFBSyxHQUFmO0lBQW9CLEdBQUEsRUFBSyxHQUF6QjtJQUE4QixHQUFBLEVBQUssR0FBbkM7OztFQUdkLE9BQUEsR0FBVSxPQUFBLENBQVEsUUFBUixDQUFpQixDQUFDLEVBQWxCLENBQXFCLElBQUksQ0FBQyxVQUExQixFQUFzQyxRQUF0Qzs7RUFFVixTQUFBLEdBQVksT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFaLENBQWlCLE9BQWpCLEVBQTBCLE9BQTFCOztFQUNaLFNBQUEsR0FBWSxTQUFBLEdBQUE7O0VBRVosTUFBTSxDQUFDLE9BQVAsR0FDRTtJQUFBLHdCQUFBLEVBQTBCLElBQTFCO0lBRUEsTUFBQSxFQUNFO01BQUEsT0FBQSxFQUNFO1FBQUEsSUFBQSxFQUFNLFNBQU47UUFDQSxDQUFBLE9BQUEsQ0FBQSxFQUFTLElBRFQ7T0FERjtLQUhGO0lBT0EsUUFBQSxFQUFVLFNBQUMsS0FBRDtNQUNSLElBQUMsQ0FBQSxhQUFELEdBQWlCLElBQUk7TUFDckIsSUFBQyxDQUFBLE9BQUQsR0FBaUIsSUFBSTtNQUVyQixJQUFDLENBQUEsT0FBRCxHQUFXLENBQUMsSUFBSSxzQkFBTCxDQUE0QixDQUFDLFVBQTdCLENBQXdDLElBQXhDO01BRVgsSUFBQyxD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TUFDUixTQUFBLENBQVUsT0FBVixFQUFtQixLQUFuQixFQUEwQixTQUExQixFQUFxQyxPQUFyQztNQUVBLElBQUcsQ0FBSSxLQUFQO2VBQ0UsSUFBQyxDQUFBLE9BQU8sQ0FBQyxZQUFULENBQUEsRUFERjtPQUFBLE1BQUE7UUFHRSxLQUFBLEdBQVEsTUFBTSxDQUFDLG9CQUFQLENBQTRCLEtBQTVCLENBQWtDLENBQUMsSUFBbkMsQ0FBQTtRQUtSLElBQWtDLEtBQUEsS0FBUyxHQUEzQztBQUFBLGlCQUFPLElBQUMsQ0FBQSxPQUFPLENBQUMsWUFBVCxDQUFBLEVBQVA7O1FBRUEsT0FBbUIsSUFBQyxDQUFBLFVBQUQsQ0FBWSxLQUFaLEVBQW1CLE9BQW5CLENBQW5CLEVBQUMsZUFBRCxFQUFRO2VBQ1IsSUFBQyxDQUFBLE9BQU8sQ0FBQyxXQUFULENBQXFCLEtBQXJCLEVBQTRCO1VBQUMsU0FBQSxPQUFEO1VBQVUsU0FBQSxPQUFWO1NBQTVCLEVBWEY7O0lBVmMsQ0EzS2hCOztBQWJGIiwic291cmNlc0NvbnRlbnQiOlsiI1JlZ2V4UmFpbHJvYWREaWFncmFtVmlldyA9IHJlcXVpcmUgJy4vcmVnZXgtcmFpbHJvYWQtZGlhZ3JhbS12aWV3J1xue0NvbXBvc2l0ZURpc3Bvc2FibGUsIEVtaXR0ZXIsIFJhbmdlfSA9IHJlcXVpcmUgJ2F0b20nXG57ZGVib3VuY2V9ID0gcmVxdWlyZSBcInVuZGVyc2NvcmUtcGx1c1wiXG5SYWlscm9hZERpYWdyYW1FbGVtZW50ID0gcmVxdWlyZSBcIi4vcmFpbHJvYWQtZGlhZ3JhbS1lbGVtZW50LmNvZmZlZVwiXG5cbk1BVENIX1BBSVJTID0gJygnOiAnKScsICdbJzogJ10nLCAneyc6ICd9JywgJzwnOiAnPidcblxuIyBJIGRvIG5vdCBrbm93LCB3aGVuIHRoaXMgaGFzIGJlZW4gZml4ZWQsIGJ1dCB3aXRoIGN1cnJlbnQgMS4xOC54IGl0IGlzIGdvbmVcbmlzc3VlNTggPSByZXF1aXJlKCdzZW12ZXInKS5sdChhdG9tLmFwcFZlcnNpb24sIFwiMS4xOC4wXCIpXG5cbmxvZ19kZWJ1ZyA9IGNvbnNvbGUubG9nLmJpbmQgY29uc29sZSwgXCJyeDJyclwiXG5sb2dfZGVidWcgPSAtPlxuXG5tb2R1bGUuZXhwb3J0cyA9XG4gIHJlZ2V4UmFpbHJvYWREaWFncmFtVmlldzogbnVsbFxuXG4gIGNvbmZpZzpcbiAgICBlbmFibGVkOlxuICAgICAgdHlwZTogXCJib29sZWFuXCJcbiAgICAgIGRlZmF1bHQ6IHRydWVcblxuICBhY3RpdmF0ZTogKHN0YXRlKSAtPlxuICAgIEBzdWJzY3JpcHRpb25zID0gbmV3IENvbXBvc2l0ZURpc3Bvc2FibGVcbiAgICBAZW1pdHRlciAgICAgICA9IG5ldyBFbWl0dGVyXG5cbiAgICBAZWxlbWVudCA9IChuZXcgUmFpbHJvYWREaWFncmFtRWxlbWVudCkuaW5pdGlhbGl6ZSB0aGlzXG5cbiAgICBAc3Vic2NyaXB0aW9ucy5hZGQgYXRvbS53b3Jrc3BhY2Uub2JzZXJ2ZVRleHRFZGl0b3JzIChlZGl0b3IpID0+XG4gICAgICBAc3Vic2NyaXB0aW9ucy5hZGQgZWRpdG9yLm9uRGlkQ2hhbmdlQ3Vyc29yUG9zaXRpb24gZGVib3VuY2UgKD0+IEBjaGVja0ZvclJlZ0V4cCgpKSwgMTAwXG5cbiAgICBAc3Vic2NyaXB0aW9ucy5hZGQgYXRvbS5jb21tYW5kcy5hZGQgJ2F0b20tdGV4dC1lZGl0b3InLFxuICAgICAgJ3JlZ2V4LXJhaWxyb2FkLWRpYWdyYW06c2hvdyc6ID0+XG4gICAgICAgIGlmIG5vdCBAZWxlbWVudC5pc1Zpc2libGUoKVxuICAgICAgICAgIGNvbnNvbGUubG9nIFwiaXMgbm90IHZpc2libGVcIlxuICAgICAgICAgIGZsYXZvdXIgPSAncGVybCdcbiAgICAgICAgICBvcHRpb25zID0gJydcbiAgICAgICAgICBlZGl0b3IgPSBhdG9tLndvcmtzcGFjZS5nZXRBY3RpdmVUZXh0RWRpdG9yKClcbiAgICAgICAgICBAZWxlbWVudC5zaG93RGlhZ3JhbSBlZGl0b3IuZ2V0U2VsZWN0ZWRUZXh0KCksIHtmbGF2b3VyLCBvcHRpb25zfVxuICAgICAgICAgICNlZGl0b3Iuc2Nyb2xsVG9DdXJzb3JQb3NpdGlvbigpXG5cbiAgICAgICAgICBAZWxlbWVudC5mb2N1c1RleHRFZGl0b3IoKVxuICAgICAgICBlbHNlXG4gICAgICAgICAgY29uc29sZS5sb2cgXCJpcyB2aXNpYmxlXCJcblxuICAgICAgIyAgZWxzZSBUT0RPXG4jICAgICAgICBQcm9ibGVtOiBvbiBjb25maXJtIHRoZSByZWdleCBtYXJrZXJzIGFyZSBhbHNvIG92ZXJyaWRkZW5cbiMgICAgICAgICAgZWRpdG9yID0gYXRvbS53b3Jrc3BhY2UuZ2V0QWN0aXZlVGV4dEVkaXRvcigpXG4jICAgICAgICAgICMgc2VsZWN0IGN1cnJlbnQgcmVnZXggZmlyc3RcbiMgICAgICAgICAgW3JhbmdlLCBmbGF2b3VyXSA9IEBnZXRSZWdleHBCdWZmZXJSYW5nZSBlZGl0b3JcbiMgICAgICAgICAgZWRpdG9yLnNldFNlbGVjdGVkQnVmZmVyUmFuZ2UgcmFuZ2VcbiMgICAgICAgICAgQGVsZW1lbnQuZm9jdXNUZXh0RWRpdG9yKClcblxuXG5cbiAgICBpZiBhdG9tLmNvbmZpZy5nZXQoJ3JlZ2V4LXJhaWxyb2FkLWRpYWdyYW0uZW5hYmxlZCcpXG4gICAgICBAYWRkRGlzYWJsZUNvbW1hbmQoKVxuICAgIGVsc2VcbiAgICAgIEBhZGRFbmFibGVDb21tYW5kKClcblxuXG4gIGFkZERpc2FibGVDb21tYW5kOiAtPlxuICAgIEBjdXJfY21kID0gYXRvbS5jb21tYW5kcy5hZGQgXCJhdG9tLXdvcmtzcGFjZVwiLCBcInJlZ2V4LXJhaWxyb2FkLWRpYWdyYW06ZGlzYWJsZVwiLCA9PlxuICAgICAgQGN1cl9jbWQuZGlzcG9zZSgpXG4gICAgICBhdG9tLmNvbmZpZy5zZXQoJ3JlZ2V4LXJhaWxyb2FkLWRpYWdyYW0uZW5hYmxlZCcsIGZhbHNlKVxuICAgICAgQGFkZEVuYWJsZUNvbW1hbmQoKVxuICAgICAgQGNoZWNrRm9yUmVnRXhwKClcblxuICBhZGRFbmFibGVDb21tYW5kOiAtPlxuICAgIEBjdXJfY21kID0gYXRvbS5jb21tYW5kcy5hZGQgXCJhdG9tLXdvcmtzcGFjZVwiLCBcInJlZ2V4LXJhaWxyb2FkLWRpYWdyYW06ZW5hYmxlXCIsID0+XG4gICAgICBAY3VyX2NtZC5kaXNwb3NlKClcbiAgICAgIGF0b20uY29uZmlnLnNldCgncmVnZXgtcmFpbHJvYWQtZGlhZ3JhbS5lbmFibGVkJywgdHJ1ZSlcbiAgICAgIEBhZGREaXNhYmxlQ29tbWFuZCgpXG4gICAgICBAY2hlY2tGb3JSZWdFeHAoKVxuXG4gIGRlYWN0aXZhdGU6IC0+XG4gICAgI0ByZWdleFJhaWxyb2FkRGlhZ3JhbVZpZXcuZGVzdHJveSgpXG4gICAgQHN1YnNjcmlwdGlvbnMuZGlzcG9zZSgpXG5cbiAgc2VyaWFsaXplOiAtPlxuICAgICNyZWdleFJhaWxyb2FkRGlhZ3JhbVZpZXdTdGF0ZTogQHJlZ2V4UmFpbHJvYWREaWFncmFtVmlldy5zZXJpYWxpemUoKVxuXG4gIGJ1ZmZlclJhbmdlRm9yU2NvcGU6IChlZGl0b3IsIHNjb3BlLCBwb3NpdGlvbj1udWxsKSAtPlxuICAgIHVubGVzcyBpc3N1ZTU4XG4gICAgICBpZiBwb3NpdGlvbj9cbiAgICAgICAgcmVzdWx0ID0gZWRpdG9yLmJ1ZmZlclJhbmdlRm9yU2NvcGVBdFBvc2l0aW9uKHNjb3BlLCBwb3NpdGlvbilcbiAgICAgIGVsc2VcbiAgICAgICAgcmVzdWx0ID0gZWRpdG9yLmJ1ZmZlclJhbmdlRm9yU2NvcGVBdEN1cnNvcihzY29wZSlcbiAgICAgIHJldHVybiByZXN1bHRcblxuICAgICMgaGVyZSBmb2xsb3dzIGEgd29ya2Fyb3VuZCBmb3IgZml4aW5nICM1OCwgdGlsbCBidWZmZXJSYW5nZUZvclNjb3BlQXRDdXJzb3JcbiAgICAjIGRlbGl2ZXJzIGNvcnJlY3QgYWRkcmVzc1xuICAgICNcblxuICAgIHRhYkxlbmd0aCA9IGVkaXRvci5nZXRUYWJMZW5ndGgoKVxuXG4gICAgdW5sZXNzIHBvc2l0aW9uP1xuICAgICAgcG9zaXRpb24gPSBlZGl0b3IuZ2V0Q3Vyc29yQnVmZmVyUG9zaXRpb24oKS5jb3B5KClcblxuICAgIGxpbmVTdGFydCA9IFtbcG9zaXRpb24ucm93LCAwXSwgW3Bvc2l0aW9uLnJvdywgcG9zaXRpb24uY29sdW1uXV1cblxuICAgIGlmIG0gPSBlZGl0b3IuZ2V0VGV4dEluQnVmZmVyUmFuZ2UobGluZVN0YXJ0KS5tYXRjaCgvXFx0L2cpXG4gICAgICBzdGFydFRhYnMgPSBtLmxlbmd0aFxuICAgIGVsc2VcbiAgICAgIHN0YXJ0VGFicyA9IDBcblxuICAgICMgc2hpZnQgdGhlIHBvc2l0aW9uIGEgbGl0dGxlLCBzdWNoIHRoYXQgYWxzIGluIGNhc2Ugb2YgdGFicyBpbiBiZWdpbm5pbmdcbiAgICAjIHN0YXJ0IG9mIHJlZ2V4IGlzIHJlY29nbml6ZWQgYXMgcmVnZXhcbiAgICBpZiBzdGFydFRhYnNcbiAgICAgIHBvc2l0aW9uLmNvbHVtbiA9IHBvc2l0aW9uLmNvbHVtbiAtIHN0YXJ0VGFicyArIHN0YXJ0VGFicyp0YWJMZW5ndGhcblxuICAgIHJlc3VsdCA9IGVkaXRvci5idWZmZXJSYW5nZUZvclNjb3BlQXRQb3NpdGlvbihzY29wZSwgcG9zaXRpb24pXG4gICAgcmV0dXJuIHJlc3VsdCB1bmxlc3MgcmVzdWx0XG5cbiAgICAjIHRoaXMgaXMgdXN1YWxseSBvbmx5IG9uZSByb3csIGJ1dCBpZiBhdCBzb21lIHBvaW50IHRoZSByYW5nZSB3b3VsZCBzcGFuXG4gICAgIyBtdWx0aXBsZSByb3dzLCB0aGlzIHN0aWxsIHdvcmtzXG5cbiAgICB7c3RhcnQsIGVuZH0gPSByZXN1bHRcblxuICAgIGxpbmVTdGFydCA9IFtbZW5kLnJvdywgMF0sIFtlbmQucm93LCBlbmQuY29sdW1uXV1cbiAgICBpZiBtID0gZWRpdG9yLmdldFRleHRJbkJ1ZmZlclJhbmdlKGxpbmVTdGFydCkubWF0Y2goL1xcdC9nKVxuICAgICAgZW5kVGFicyA9IG0ubGVuZ3RoXG4gICAgZWxzZVxuICAgICAgZW5kVGFicyA9IDBcblxuICAgIHJldHVybiBuZXcgUmFuZ2UoXG4gICAgICBbc3RhcnQucm93LCBzdGFydC5jb2x1bW4gLSBzdGFydFRhYnMqdGFiTGVuZ3RoICsgc3RhcnRUYWJzXSxcbiAgICAgIFtlbmQucm93LCBlbmQuY29sdW1uIC0gZW5kVGFicyp0YWJMZW5ndGggKyBlbmRUYWJzXVxuICAgICAgKVxuXG4gIGdldFJlZ2V4cEJ1ZmZlclJhbmdlOiAoZWRpdG9yKSAtPlxuICAgIHBvc2l0aW9uID0gZWRpdG9yLmdldEN1cnNvckJ1ZmZlclBvc2l0aW9uKClcbiAgICBmbGF2b3VyID0gZWRpdG9yLnNjb3BlRGVzY3JpcHRvckZvckJ1ZmZlclBvc2l0aW9uKHBvc2l0aW9uKS5zY29wZXNbMF1cbiAgICByYW5nZSA9IEBidWZmZXJSYW5nZUZvclNjb3BlKGVkaXRvciwgJy5yYXctcmVnZXgnKVxuXG4gICAgdW5sZXNzIHJhbmdlXG4gICAgICByYW5nZSA9IEBidWZmZXJSYW5nZUZvclNjb3BlKGVkaXRvciwgJy51bmljb2RlLXJhdy1yZWdleCcpXG5cbiAgICB1bmxlc3MgcmFuZ2VcbiAgICAgIHJhbmdlID0gQGJ1ZmZlclJhbmdlRm9yU2NvcGUoZWRpdG9yLCAnLnJlZ2V4cCcpXG5cbiAgICB1bmxlc3MgcmFuZ2VcbiAgICAgIHJldHVybiBbbnVsbCwgbnVsbF1cblxuICAgIHJldHVybiBbcmFuZ2UsIGZsYXZvdXJdXG5cbiAgY2xlYW5SZWdleDogKHJlZ2V4LCBmbGF2b3VyKSAtPlxuICAgIG9wdHMgPSBcIlwiXG5cbiAgICBsb2dfZGVidWcgXCJjbGVhblJlZ2V4XCIsIHJlZ2V4LCBmbGF2b3VyXG5cbiAgICAjY29uc29sZS5sb2cgXCJyZWdleFwiLCByZWdleCwgXCJmbGF2b3VyXCIsIGZsYXZvdXJcblxuICAgIGlmIG0gPSAoZmxhdm91ci5tYXRjaCgvcGhwLykgYW5kIHJlZ2V4Lm1hdGNoKC9eKFtcIiddKVxcLyguKilcXC8oXFx3KilcXDEkLykpXG4gICAgICBbcmVnZXgsIG9wdHNdID0gbVsyLi5dXG4gICAgZWxzZSBpZiBtID0gKGZsYXZvdXIubWF0Y2goL3B5dGhvbnxqdWxpYS8pIGFuZCByZWdleC5tYXRjaCgvXnU/cignJyd8XCJcIlwifFwifCcpKC4qKVxcMSQvKSlcbiAgICAgIHJlZ2V4ID0gbVsyXVxuICAgIGVsc2UgaWYgbSA9IChmbGF2b3VyLm1hdGNoKC9jb2ZmZWUvKSBhbmQgcmVnZXgubWF0Y2goL15cXC9cXC9cXC8oLiopXFwvXFwvXFwvKFxcdyopLykpXG4gICAgICBbcmVnZXgsIG9wdHNdID0gbVsxLi5dXG4gICAgZWxzZSBpZiBtID0gKGZsYXZvdXIubWF0Y2goL3J1YnkvKSBhbmQgcmVnZXgubWF0Y2goL14lciguKSguKikoXFxXKShcXHcqKSQvKSlcbiAgICAgIFtvcGVuLCB0ZXh0LCBjbG9zZSwgb3B0c10gPSBtWzEuLl1cbiAgICAgIGV4cGVjdGVkQ2xvc2UgPSBNQVRDSF9QQUlSU1tvcGVuXSBvciBvcGVuXG4gICAgICBpZiBjbG9zZSAhPSBleHBlY3RlZENsb3NlXG4gICAgICAgIHRleHQgPSB0ZXh0ICsgY2xvc2UgKyBtWzRdXG4gICAgICAgIGNsb3NlID0gZXhwZWN0ZWRDbG9zZVxuICAgICAgcmVnZXhGb3JFc2NhcGVkID0gbmV3IFJlZ0V4cChcIlxcXFxcXFxcKCN7b3Blbn18I3tjbG9zZX0pXCIsICdnJylcbiAgICAgIHJlZ2V4ID0gdGV4dC5yZXBsYWNlKG5ldyBSZWdFeHAoXCJcXFxcL1wiLCAnXFxcXC8nKS5yZXBsYWNlKHJlZ2V4Rm9yRXNjYXBlZCwgJyQxJykpXG4gICAgZWxzZSBpZiBtID0gKGZsYXZvdXIubWF0Y2goL3BlcmwvKSBhbmQgKFxuICAgICAgICByZWdleC5tYXRjaCgvXig/Om18cXIpKC4pKC4qKShcXDF8XFxXKShcXHcqKSQvKSBvclxuICAgICAgICByZWdleC5tYXRjaCgvXnMoLikoLiopKFxcMXxcXFcpKD86XFwxLipcXFd8LipcXDEpKFxcdyopJC8pXG4gICAgICApKVxuICAgICAgW29wZW4sIHRleHQsIGNsb3NlLCBvcHRzXSA9IG1bMS4uXVxuICAgICAgZXhwZWN0ZWRDbG9zZSA9IE1BVENIX1BBSVJTW29wZW5dIG9yIG9wZW5cbiAgICAgIGlmIGNsb3NlICE9IGV4cGVjdGVkQ2xvc2VcbiAgICAgICAgdGV4dCA9IHRleHQgKyBjbG9zZSArIG1bNF1cbiAgICAgICAgY2xvc2UgPSBleHBlY3RlZENsb3NlXG4gICAgICByZWdleEZvckVzY2FwZWQgPSBuZXcgUmVnRXhwKFwiXFxcXFxcXFwoI3tvcGVufXwje2Nsb3NlfSlcIiwgJ2cnKVxuICAgICAgcmVnZXggPSB0ZXh0LnJlcGxhY2UoL1xcLy8sICdcXFxcLycpLnJlcGxhY2UocmVnZXhGb3JFc2NhcGVkLCAnJDEnKVxuICAgIGVsc2UgaWYgbSA9IHJlZ2V4Lm1hdGNoKC9eXFwvKC4qKVxcLyhcXHcqKSQvKVxuICAgICAgW3JlZ2V4LCBvcHRzXSA9IG1bMS4uXVxuXG4gICAgI2NvbnNvbGUubG9nIFwicmVnZXhcIiwgcmVnZXgsIFwiZmxhdm91clwiLCBmbGF2b3VyLCBcIm9wdHNcIiwgb3B0c1xuXG4gICAgbG9nX2RlYnVnIFwiY2xlYW5SZWdleCBkb25lOlwiLCByZWdleCwgb3B0c1xuICAgIHJldHVybiBbcmVnZXgsIG9wdHNdXG5cbiAgY2hlY2tGb3JSZWdFeHA6IC0+XG4gICAgaWYgbm90IGF0b20uY29uZmlnLmdldCgncmVnZXgtcmFpbHJvYWQtZGlhZ3JhbS5lbmFibGVkJylcbiAgICAgIHJldHVybiBAZWxlbWVudC5hc3NlcnRIaWRkZW4oKVxuXG4gICAgZWRpdG9yID0gYXRvbS53b3Jrc3BhY2UuZ2V0QWN0aXZlVGV4dEVkaXRvcigpXG4gICAgcmV0dXJuIHVubGVzcyBlZGl0b3I/XG5cbiAgICBbcmFuZ2UsIGZsYXZvdXJdID0gQGdldFJlZ2V4cEJ1ZmZlclJhbmdlIGVkaXRvclxuICAgIGxvZ19kZWJ1ZyBcInJhbmdlXCIsIHJhbmdlLCBcImZsYXZvdXJcIiwgZmxhdm91clxuXG4gICAgaWYgbm90IHJhbmdlXG4gICAgICBAZWxlbWVudC5hc3NlcnRIaWRkZW4oKVxuICAgIGVsc2VcbiAgICAgIHJlZ2V4ID0gZWRpdG9yLmdldFRleHRJbkJ1ZmZlclJhbmdlKHJhbmdlKS50cmltKClcblxuICAgICAgIyBzcGVjaWFsIGNhc2UsIG1heWJlIHdlIGdldCBhIGNvbW1lbnQsIGJ1dCBpdCBtaWdodCBiZSBhbHJlYWR5XG4gICAgICAjIG1hcmtlZCBhcyByZWdleCBieSBsYW5ndWFnZSBncmFtbWFyLCBhbHRob3VnaCBpdCBtaWdodCByZXN1bHQgaW5cbiAgICAgICMgYSBjb21tZW50XG4gICAgICByZXR1cm4gQGVsZW1lbnQuYXNzZXJ0SGlkZGVuKCkgaWYgcmVnZXggaXMgJy8nXG5cbiAgICAgIFtyZWdleCwgb3B0aW9uc10gPSBAY2xlYW5SZWdleCByZWdleCwgZmxhdm91clxuICAgICAgQGVsZW1lbnQuc2hvd0RpYWdyYW0gcmVnZXgsIHtmbGF2b3VyLCBvcHRpb25zfVxuICAgICAgI2VkaXRvci5zY3JvbGxUb0N1cnNvclBvc2l0aW9uKClcblxuICAjICAgaWYgbm90IHJhbmdlXG4gICMgICAgIEBlbWl0dGVyLmVtaXQgJ2RpZC1ub3QtZmluZC1yZWdleHAnXG4gICMgICBlbHNlXG4gICMgICAgIEBlbWl0dGVyLmVtaXQgJ2RpZC1maW5kLXJlZ2V4cCcsIGVkaXRvci5nZXRUZXh0SW5CdWZmZXJSYW5nZSByYW5nZVxuICAjXG4gICMgb25EaWROb3RGaW5kUmVnZXhwOiAoY2FsbGJhY2spIC0+XG4gICMgICBAZW1pdHRlci5vbiAnZGlkLW5vdC1maW5kLXJlZ2V4cCcsIGNhbGxiYWNrXG4gICNcbiAgIyBvbkRpZEZpbmRSZWdleHA6IChjYWxsYmFjaykgLT5cbiAgIyAgIEBlbWl0dGVyLm9uICdkaWQtZmluZC1yZWdleHAnLCBjYWxsYmFja1xuIl19
